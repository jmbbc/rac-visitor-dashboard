<!doctype html>
<html lang="ms">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Dashboard Keselamatan — Banjaria Court</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/style.css">
  <style>
    /* Local dashboard tweaks */
    .dashboard-wrap { display: grid; grid-template-columns: 260px 1fr; gap: 16px; align-items: start; }
    @media (max-width: 880px) { .dashboard-wrap { grid-template-columns: 1fr; } }

    .sidebar { padding: 12px; border-radius:8px; background:var(--card); box-shadow:0 1px 3px rgba(0,0,0,0.06); }
    .sidebar nav { display:flex; flex-direction:column; gap:6px; }
    .sidebar button.nav-item { text-align:left; padding:8px 10px; border-radius:8px; border:1px solid var(--input-border); background:transparent; cursor:pointer; font-weight:600; transition: background .12s, color .12s; }
    .sidebar button.nav-item.active { background: var(--accent); color:#fff; border-color:var(--accent); }
    .sidebar button.nav-item:active { transform: translateY(1px); }

    .top-info { display:flex; justify-content:space-between; gap:12px; align-items:center; margin-bottom:12px; flex-wrap:wrap; }
    .kpi { display:flex; gap:8px; align-items:center; flex-wrap:wrap; }
    .kpi .chip { background:var(--card); border:1px solid var(--input-border); padding:8px 10px; border-radius:8px; font-weight:700; }

    .table { width:100%; border-collapse:collapse; font-size:14px; }
    .table th, .table td { padding:8px; border-bottom:1px solid var(--input-border); text-align:left; vertical-align:middle; }
    .table td .small { display:block; color:var(--muted); margin-top:6px; font-size:12px; }

    .actions { display:flex; gap:8px; align-items:center; }
    .actions button { min-width:96px; padding:8px 10px; border-radius:8px; }

    tr.conflict td { background: rgba(255,243,205,0.6); }

    .tel-link { color: var(--accent); font-weight:600; text-decoration: none; }
    .tel-link:hover { text-decoration: underline; }

    .table-wrap { overflow-x:auto; }

    @media (max-width: 640px) {
      .login-box { margin:8px 0; }
      .actions button { min-width:72px; padding:8px 6px; }
    }

    /* Modal base (kept minimal; additional styles in css/style.css) */
    .modal.hidden { display:none !important; }
  </style>
</head>
<body>
  <main class="container" style="padding:18px 12px;">
    <a href="index.html" class="small">← Kembali</a>
    <h2 style="margin-top:8px">Dashboard Keselamatan</h2>

    <div id="loginBox" class="login-box card small" style="max-width:420px;margin-top:12px">
      <label>Email</label>
      <input id="loginEmail" type="email" />
      <label>Password</label>
      <input id="loginPass" type="password" />
      <div class="row" style="margin-top:8px">
        <button id="loginBtn">Log Masuk</button>
        <button id="logoutBtn" style="display:none" class="btn-ghost">Log Keluar</button>
      </div>
      <div id="loginMsg" role="status" aria-live="polite" class="small" style="margin-top:8px"></div>
    </div>

    <div id="dashboardArea" style="display:none; margin-top:12px">
      <div class="dashboard-wrap">
        <!-- Sidebar -->
        <aside class="sidebar" aria-label="Navigasi Dashboard">
          <div style="margin-bottom:10px">
            <div class="small muted">Tarikh hari ini</div>
            <div id="todayLabel" style="font-weight:800;font-size:16px;margin-top:6px"></div>
            <div id="todayTime" class="muted-small" style="margin-top:4px"></div>
          </div>

          <nav>
            <button id="navSummary" class="nav-item active">Senarai pendaftaran</button>
            <button id="navCheckedIn" class="nav-item">Pelawat Checked In (Hari Ini)</button>
            <hr style="border:none;border-top:1px solid var(--input-border);margin:10px 0">
            <div class="muted-small">Alat</div>
            <button id="reloadBtn" class="nav-item">Refresh Data</button>
            <!-- Export CSV button removed as requested -->
            <!-- Submenu baru -->
            <button id="navParking" class="nav-item">Laporan Parkir Pelawat</button>
          </nav>
        </aside>

        <!-- Main -->
        <section>
          <div class="top-info">
            <div>
              <div class="small">Log masuk sebagai: <strong id="who"></strong></div>
              <div id="kpiWrap" style="margin-top:8px" class="kpi"></div>
            </div>

            <div style="display:flex;gap:8px;align-items:center">
              <label for="filterDate" class="small muted">Tunjuk mengikut ETA</label>
              <input id="filterDate" type="date" />
            </div>
          </div>

          <!-- injected controls (overlap) -->
          <div id="injectedControls"></div>

          <!-- Pages -->
          <div id="pageSummary">
            <div id="listAreaSummary" style="margin-top:8px"></div>
          </div>

          <div id="pageCheckedIn" style="display:none">
            <h3 style="margin-top:6px">Pelawat Checked In — Hari Ini</h3>
            <div id="listAreaCheckedIn" style="margin-top:8px"></div>
          </div>

          <!-- Halaman Parkir: dua kolum, kad selari -->
          <div id="pageParking" style="display:none; margin-top:12px;">
            <div class="card card-tight">
              <h3 style="margin-top:0">Laporan Parkir Pelawat</h3>

              <div class="parking-header">
                <div class="ph-item">
                  <div class="small muted">Tarikh</div>
                  <div id="parkingDateLabel" class="ph-value"></div>
                </div>
                <div class="ph-item">
                  <div class="small muted">Waktu</div>
                  <div class="ph-value">12:00 am</div>
                </div>
                <div class="ph-item ph-grow">
                  <label for="parkingPKName" class="small muted">Nama PK</label>
                  <input id="parkingPKName" placeholder="Nama PK" />
                </div>
                <div class="ph-item">
                  <button id="parkingSaveAll" class="btn">Simpan Semua</button>
                </div>
              </div>

              <div class="parking-grid">
                <div class="card card-tight">
                  <h4 class="parking-title">Lot Parkir Pelawat Bahagian Masuk</h4>
                  <div id="parkingMasuk" class="parking-list"></div>
                </div>

                <div class="card card-tight">
                  <h4 class="parking-title">Lot Parkir Pelawat Bahagian Luar</h4>
                  <div id="parkingLuar" class="parking-list"></div>
                </div>
              </div>
            </div>
          </div>
        </section>
      </div>
    </div>
  </main>

  <!-- Edit modal (placed once) -->
  <div id="editModal" class="modal hidden" role="dialog" aria-modal="true" aria-hidden="true" aria-labelledby="editModalLabel" style="position:fixed;inset:0;display:flex;align-items:center;justify-content:center;z-index:12000;">
    <div class="card" style="width:420px;max-width:95%;padding:16px;position:relative;">
      <button id="closeEditModal" aria-label="Tutup" style="position:absolute;right:10px;top:10px;border:0;background:transparent;font-weight:700;cursor:pointer">×</button>
      <h3 id="editModalLabel" style="margin-top:0">Isi / Kemas Kini Butiran</h3>

      <form id="editForm">
        <label style="font-weight:700;margin-top:8px">Unit / Tuan Rumah</label>
        <input id="editUnit" name="unit" placeholder="Contoh: A-12-03" />

        <label style="font-weight:700;margin-top:8px">ETA</label>
        <input id="editETA" name="eta" type="date" />

        <label style="font-weight:700;margin-top:8px">ETD</label>
        <input id="editETD" name="etd" type="date" />

        <label style="font-weight:700;margin-top:8px">Kenderaan (nombor / senarai)</label>
        <input id="editVehicle" name="vehicle" placeholder="ABC1234 atau ABC1234;XYZ5678" />

        <label style="font-weight:700;margin-top:8px">Status</label>
        <select id="editStatus" name="status">
          <option value="Pending">Pending</option>
          <option value="Checked In">Checked In</option>
          <option value="Checked Out">Checked Out</option>
        </select>

        <div class="actions" style="justify-content:flex-end;margin-top:12px;">
          <button type="button" id="saveEditBtn" class="btn">Simpan</button>
          <button type="button" id="cancelEditBtn" class="btn-ghost">Batal</button>
        </div>
        <input type="hidden" id="editDocId" />
      </form>
    </div>
  </div>

  <!-- Modal edit slot (satu sahaja dalam halaman) -->
  <div id="parkingSlotModal" class="modal hidden" aria-hidden="true" role="dialog" aria-labelledby="parkingSlotModalLabel">
    <div class="card card-tight" style="width:520px;max-width:95%;">
      <button id="closeParkingModal" aria-label="Tutup" style="position:absolute;right:12px;top:12px;border:0;background:transparent;font-size:20px;cursor:pointer">×</button>
      <h3 id="parkingSlotModalLabel" style="margin-top:0">Edit Lot Parkir</h3>
      <form id="parkingSlotForm">
        <div class="form-row grid">
          <label>Lot</label>
          <div><input id="slotNumber" disabled /></div>
        </div>
        <div class="form-row grid">
          <label>Nombor Kenderaan</label>
          <div><input id="slotVehicle" placeholder="Contoh: ABC1234" class="force-mono" /></div>
        </div>
        <div class="form-row grid">
          <label>Unit Rumah</label>
          <div><input id="slotUnit" placeholder="Contoh: B1-1-1" /></div>
        </div>
        <div class="form-row grid">
          <label>ETA</label>
          <div><input id="slotETA" type="date" /></div>
        </div>
        <div class="form-row grid">
          <label>ETD</label>
          <div><input id="slotETD" type="date" /></div>
        </div>

        <div class="actions" style="justify-content:flex-end;">
          <button type="button" id="saveSlotBtn" class="btn">Simpan</button>
          <button type="button" id="clearSlotBtn" class="btn-ghost">Kosongkan</button>
          <button type="button" id="cancelSlotBtn" class="btn-ghost">Batal</button>
        </div>
        <input type="hidden" id="slotDocId" />
      </form>
    </div>
  </div>

  <div id="spinner" style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(255,255,255,0.6);z-index:9999;align-items:center;justify-content:center;">
    <div style="background:#fff;padding:24px 32px;border-radius:16px;box-shadow:0 2px 12px rgba(0,0,0,0.12);display:flex;flex-direction:column;align-items:center;">
      <div class="loader" style="width:48px;height:48px;border:6px solid #eee;border-top:6px solid var(--accent);border-radius:50%;animation:spin 1s linear infinite;"></div>
      <div style="margin-top:12px;font-weight:600;color:var(--accent)">Memuat data...</div>
    </div>
  </div>
  <script>
    // Spinner animation
    const style = document.createElement('style');
    style.textContent = `@keyframes spin { 0% { transform: rotate(0deg);} 100% {transform: rotate(360deg);} }`;
    document.head.appendChild(style);
  </script>
  <script type="module" src="js/firebase-init.js"></script>
  <script type="module" src="js/dashboard.js"></script>
</body>
</html>
